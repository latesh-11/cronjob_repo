name: Weekly Merge Develop to Stage

on:
 schedule:
    - cron: '0 0 * * 1' # This runs the job every Monday at midnight UTC

jobs:
 merge:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v2
      with:
        ref: develop

    - name: Create a new branch
      run: |
        BRANCH="pr_$(date +%s)"
        git checkout -b $BRANCH

    - name: Make a dummy commit if no changes are present
      run: |
        if [ -z "$(git status --porcelain)" ]; then
          echo "No changes to commit. Making a dummy commit."
          touch dummy.txt
          git add dummy.txt
          git commit -m "Dummy commit to avoid 'No commits between stage and pr_1710746942' error"
        fi

    - name: Push the branch to remote
      run: |
        git push origin $BRANCH

    - name: Create a pull request
      uses: peter-evans/create-pull-request@v3
      with:
        title: "Weekly merge develop to stage"
        body: "Automated pull request to merge changes from develop to stage."
        base: stage
        head: ${{ github.actor }}:${{ github.ref }}
        draft: false
        reviewers: cyz@gmail.com,xyz@gmail.com
